import{a as g,b as L,$ as w}from"./index-SZZn8Far.js";g(import.meta.url);function C(){const i=document.createElement("div");return i.innerHTML='<div class="lds-ring"><div></div><div></div><div></div><div></div></div>',i.firstElementChild}class S{async show(c,E){await g(import.meta.url);const s=document.getElementById("comfy-user-selection");return s.style.display="",new Promise(a=>{const t=s.getElementsByTagName("input")[0],e=s.getElementsByTagName("select")[0],m=t.closest("section"),f=e.closest("section"),x=s.getElementsByTagName("form")[0],o=s.getElementsByClassName("comfy-user-error")[0],b=s.getElementsByClassName("comfy-user-button-next")[0];let l=null;if(t.addEventListener("focus",()=>{m.classList.add("selected"),f.classList.remove("selected"),l=!0}),e.addEventListener("focus",()=>{m.classList.remove("selected"),f.classList.add("selected"),l=!1,e.style.color=""}),e.addEventListener("blur",()=>{e.value||(e.style.color="var(--descrip-text)")}),x.addEventListener("submit",async r=>{if(r.preventDefault(),l==null)o.textContent="Please enter a username or select an existing user.";else if(l){const u=t.value.trim();if(!u){o.textContent="Please enter a username.";return}t.disabled=e.disabled=t.readonly=e.readonly=!0;const y=C();b.prepend(y);try{const n=await L.createUser(u);if(n.status>=300){let p="Error creating user: "+n.status+" "+n.statusText;try{const d=await respon();d.error&&(p=d.error)}catch{}throw new Error(p)}a({username:u,userId:await respon(),created:!0})}catch(n){y.remove(),o.textContent=n.message??n.statusText??n??"An unknown error occurred.",t.disabled=e.disabled=t.readonly=e.readonly=!1;return}}else if(e.value)a({username:c[e.value],userId:e.value,created:!1});else{o.textContent="Please select an existing user.";return}}),E){const r=localStorage["Comfy.userName"];r&&(t.value=r)}t.value&&t.focus();const v=Object.keys(c??{});if(v.length){for(const r of v)w("option",{textContent:c[r],value:r,parent:e});e.style.color="var(--descrip-text)",e.value&&e.focus()}else s.classList.add("no-users"),t.focus()}).then(a=>(s.remove(),a))}}export{S as UserSelectionScreen};
